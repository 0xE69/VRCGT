<UserControl x:Class="VRCGroupTools.Views.CalendarEventView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes">
    <Grid Margin="0,0,10,0">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Form -->
        <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="0,0,16,0">
                <TextBlock Text="ðŸ“… Calendar Events" FontSize="24" FontWeight="Bold" Foreground="White" Margin="0,0,0,4"/>
                <TextBlock Text="Create, schedule, repeat, and template events." Foreground="#AAA" Margin="0,0,0,20"/>

                <Border Background="#2D2D30" CornerRadius="8" Padding="16" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="Create Event" FontSize="18" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,12"/>

                        <TextBox Text="{Binding Draft.Name, UpdateSourceTrigger=PropertyChanged}" 
                                 materialDesign:HintAssist.Hint="Event name" 
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}" 
                                 Foreground="White"/>

                        <ComboBox ItemsSource="{Binding Categories}" SelectedItem="{Binding Draft.Category, Mode=TwoWay}" 
                                  materialDesign:HintAssist.Hint="Category" 
                                  Margin="0,10,0,0"
                                  Style="{StaticResource MaterialDesignOutlinedComboBox}" 
                                  Foreground="White"/>

                        <ComboBox ItemsSource="{Binding VisibilityOptions}" SelectedItem="{Binding Draft.Visibility, Mode=TwoWay}" 
                                  materialDesign:HintAssist.Hint="Visibility (Public/Group)" 
                                  Margin="0,10,0,0"
                                  Style="{StaticResource MaterialDesignOutlinedComboBox}" 
                                  Foreground="White"/>

                        <TextBlock Text="Languages" Foreground="#AAA" FontSize="12" Margin="0,10,0,4"/>
                        <ItemsControl ItemsSource="{Binding LanguageOptions}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <CheckBox Content="{Binding Display}" IsChecked="{Binding IsSelected, Mode=TwoWay}" Margin="0,0,8,6" Foreground="White" Style="{StaticResource MaterialDesignCheckBox}"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <TextBlock Text="Platforms" Foreground="#AAA" FontSize="12" Margin="0,10,0,4"/>
                        <StackPanel Orientation="Horizontal">
                            <CheckBox Content="Windows" IsChecked="{Binding DraftPlatformWindows}" Foreground="White" Style="{StaticResource MaterialDesignCheckBox}"/>
                            <CheckBox Content="Android" IsChecked="{Binding DraftPlatformAndroid}" Foreground="White" Style="{StaticResource MaterialDesignCheckBox}" Margin="12,0,0,0"/>
                            <CheckBox Content="iOS" IsChecked="{Binding DraftPlatformIos}" Foreground="White" Style="{StaticResource MaterialDesignCheckBox}" Margin="12,0,0,0"/>
                        </StackPanel>

                        <TextBox Text="{Binding DraftTagsText, UpdateSourceTrigger=PropertyChanged}" 
                                 materialDesign:HintAssist.Hint="Tags (comma separated)" 
                                 Margin="0,10,0,0"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}" 
                                 Foreground="White"/>

                        <TextBox Text="{Binding Draft.Description, UpdateSourceTrigger=PropertyChanged}" 
                                 materialDesign:HintAssist.Hint="Description" 
                                 Margin="0,10,0,0"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}" 
                                 Foreground="White" 
                                 AcceptsReturn="True" Height="80" TextWrapping="Wrap"/>

                        <Grid Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Margin="0,0,8,0">
                                <TextBlock Text="Start Time" Foreground="#AAA" FontSize="12"/>
                                <DatePicker SelectedDate="{Binding Draft.StartTime, Mode=TwoWay}"/>
                                <TextBox Text="{Binding Draft.StartTime, StringFormat=HH:mm}" Margin="0,6,0,0"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                <TextBlock Text="End Time" Foreground="#AAA" FontSize="12"/>
                                <DatePicker SelectedDate="{Binding Draft.EndTime, Mode=TwoWay}"/>
                                <TextBox Text="{Binding Draft.EndTime, StringFormat=HH:mm}" Margin="0,6,0,0"/>
                            </StackPanel>
                        </Grid>

                        <CheckBox Content="Send Notification" IsChecked="{Binding Draft.SendNotification}" Foreground="White" Margin="0,10,0,0" Style="{StaticResource MaterialDesignCheckBox}"/>

                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <TextBox Text="{Binding Draft.ThumbnailPath, UpdateSourceTrigger=PropertyChanged}" 
                                     materialDesign:HintAssist.Hint="Thumbnail (optional)" 
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}" 
                                     Foreground="White" Width="260" IsReadOnly="True"/>
                            <Button Content="Browse" Command="{Binding BrowseEventThumbnailCommand}" Margin="8,0,0,0" Width="80" Style="{StaticResource MaterialDesignRaisedButton}"/>
                        </StackPanel>

                        <TextBlock Text="Recurrence" Foreground="#AAA" FontSize="12" Margin="0,10,0,4"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <CheckBox Content="Enable" IsChecked="{Binding Draft.Recurrence.Enabled}" Foreground="White" Style="{StaticResource MaterialDesignCheckBox}"/>
                            <ComboBox ItemsSource="{Binding RecurrenceTypes}" SelectedItem="{Binding DraftRecurrenceType, Mode=TwoWay}" 
                                      materialDesign:HintAssist.Hint="Type" Width="160" Margin="8,0,0,0"
                                      Style="{StaticResource MaterialDesignOutlinedComboBox}" Foreground="White"/>
                            <DatePicker SelectedDate="{Binding DraftRecurrenceUntil, Mode=TwoWay}" Width="150" Margin="8,0,0,0"/>
                        </StackPanel>

                        <!-- Weekly options -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6" Visibility="{Binding DraftRecurrenceType, Converter={StaticResource StringMatchToVisibility}, ConverterParameter=Weekly}">
                            <ToggleButton Content="Sun" IsChecked="{Binding RecSun}" Width="44" Margin="0,0,4,0"/>
                            <ToggleButton Content="Mon" IsChecked="{Binding RecMon}" Width="44" Margin="0,0,4,0"/>
                            <ToggleButton Content="Tue" IsChecked="{Binding RecTue}" Width="44" Margin="0,0,4,0"/>
                            <ToggleButton Content="Wed" IsChecked="{Binding RecWed}" Width="44" Margin="0,0,4,0"/>
                            <ToggleButton Content="Thu" IsChecked="{Binding RecThu}" Width="44" Margin="0,0,4,0"/>
                            <ToggleButton Content="Fri" IsChecked="{Binding RecFri}" Width="44" Margin="0,0,4,0"/>
                            <ToggleButton Content="Sat" IsChecked="{Binding RecSat}" Width="44"/>
                        </StackPanel>

                        <!-- Monthly options -->
                        <TextBox Text="{Binding DraftMonthDaysText, UpdateSourceTrigger=PropertyChanged}" 
                                 materialDesign:HintAssist.Hint="Month days (e.g. 1,15,28)" 
                                 Margin="0,0,0,6"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}" 
                                 Foreground="White"
                                 Visibility="{Binding DraftRecurrenceType, Converter={StaticResource StringMatchToVisibility}, ConverterParameter=Monthly}"/>

                        <!-- Specific date options -->
                        <StackPanel Visibility="{Binding DraftRecurrenceType, Converter={StaticResource StringMatchToVisibility}, ConverterParameter=SpecificDates}">
                            <StackPanel Orientation="Horizontal">
                                <DatePicker SelectedDate="{Binding DraftSpecificDate, Mode=TwoWay}" Width="150"/>
                                <Button Content="Add" Command="{Binding AddSpecificDateCommand}" Width="60" Margin="8,0,0,0" Style="{StaticResource MaterialDesignRaisedButton}"/>
                            </StackPanel>
                            <ListBox ItemsSource="{Binding DraftSpecificDates}" Height="80" Background="#2D2D30" Foreground="White" BorderThickness="0" Margin="0,6,0,0">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch">
                                            <TextBlock Text="{Binding StringFormat=yyyy-MM-dd}" VerticalAlignment="Center"/>
                                            <Button Content="Remove" Command="{Binding DataContext.RemoveSpecificDateCommand, RelativeSource={RelativeSource AncestorType=ListBox}}" CommandParameter="{Binding}" Height="24" Margin="8,0,0,0" Style="{StaticResource MaterialDesignFlatButton}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </StackPanel>

                        <Button Content="Create Event" Command="{Binding SaveEventCommand}"
                                Height="40" Margin="0,14,0,0" Background="#7C4DFF" Foreground="White" Style="{StaticResource MaterialDesignRaisedButton}"/>
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Sync from VRChat" Command="{Binding SyncFromVrChatCommand}" Height="32" Width="150" Style="{StaticResource MaterialDesignRaisedButton}"/>
                            <Button Content="Refresh Recurrence" Command="{Binding RefreshCommand}" Height="32" Width="150" Margin="8,0,0,0" Style="{StaticResource MaterialDesignFlatButton}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <Border Background="#2D2D30" CornerRadius="8" Padding="16">
                    <StackPanel>
                        <TextBlock Text="Templates" FontSize="18" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,12"/>
                        <TextBox Text="{Binding TemplateDraft.Name, UpdateSourceTrigger=PropertyChanged}" materialDesign:HintAssist.Hint="Template name" Style="{StaticResource MaterialDesignOutlinedTextBox}" Foreground="White"/>
                        <ComboBox ItemsSource="{Binding Categories}" SelectedItem="{Binding TemplateDraft.Category, Mode=TwoWay}" materialDesign:HintAssist.Hint="Category" Margin="0,10,0,0" Style="{StaticResource MaterialDesignOutlinedComboBox}" Foreground="White"/>
                        <ComboBox ItemsSource="{Binding VisibilityOptions}" SelectedItem="{Binding TemplateDraft.Visibility, Mode=TwoWay}" materialDesign:HintAssist.Hint="Visibility" Margin="0,10,0,0" Style="{StaticResource MaterialDesignOutlinedComboBox}" Foreground="White"/>
                        <TextBlock Text="Languages" Foreground="#AAA" FontSize="12" Margin="0,10,0,4"/>
                        <ItemsControl ItemsSource="{Binding TemplateLanguageOptions}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <CheckBox Content="{Binding Display}" IsChecked="{Binding IsSelected, Mode=TwoWay}" Margin="0,0,8,6" Foreground="White" Style="{StaticResource MaterialDesignCheckBox}"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <TextBlock Text="Platforms" Foreground="#AAA" FontSize="12" Margin="0,10,0,4"/>
                        <StackPanel Orientation="Horizontal">
                            <CheckBox Content="Windows" IsChecked="{Binding TemplatePlatformWindows}" Foreground="White" Style="{StaticResource MaterialDesignCheckBox}"/>
                            <CheckBox Content="Android" IsChecked="{Binding TemplatePlatformAndroid}" Foreground="White" Style="{StaticResource MaterialDesignCheckBox}" Margin="12,0,0,0"/>
                            <CheckBox Content="iOS" IsChecked="{Binding TemplatePlatformIos}" Foreground="White" Style="{StaticResource MaterialDesignCheckBox}" Margin="12,0,0,0"/>
                        </StackPanel>
                        <TextBox Text="{Binding TemplateTagsText, UpdateSourceTrigger=PropertyChanged}" materialDesign:HintAssist.Hint="Tags (comma separated)" Margin="0,10,0,0" Style="{StaticResource MaterialDesignOutlinedTextBox}" Foreground="White"/>
                        <TextBox Text="{Binding TemplateDraft.Description, UpdateSourceTrigger=PropertyChanged}" materialDesign:HintAssist.Hint="Description" Margin="0,10,0,0" Style="{StaticResource MaterialDesignOutlinedTextBox}" Foreground="White" AcceptsReturn="True" Height="60" TextWrapping="Wrap"/>
                        <TextBox Text="{Binding TemplateDraft.Duration}" materialDesign:HintAssist.Hint="Duration (hh:mm:ss)" Margin="0,10,0,0" Style="{StaticResource MaterialDesignOutlinedTextBox}" Foreground="White"/>
                        <CheckBox Content="Send Notification" IsChecked="{Binding TemplateDraft.SendNotification}" Foreground="White" Margin="0,10,0,0" Style="{StaticResource MaterialDesignCheckBox}"/>
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <TextBox Text="{Binding TemplateDraft.ThumbnailPath, UpdateSourceTrigger=PropertyChanged}" materialDesign:HintAssist.Hint="Thumbnail (optional)" Style="{StaticResource MaterialDesignOutlinedTextBox}" Foreground="White" Width="260" IsReadOnly="True"/>
                            <Button Content="Browse" Command="{Binding BrowseTemplateThumbnailCommand}" Margin="8,0,0,0" Width="80" Style="{StaticResource MaterialDesignRaisedButton}"/>
                        </StackPanel>
                        <Button Content="Save Template" Command="{Binding SaveTemplateCommand}" Height="36" Margin="0,12,0,0" Style="{StaticResource MaterialDesignRaisedButton}"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Lists -->
        <StackPanel Grid.Column="1" Margin="10,0,0,0">
            <TextBlock Text="Upcoming Events" FontSize="16" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,8"/>
            <ListBox ItemsSource="{Binding Events}" SelectedItem="{Binding SelectedEvent}" Background="#2D2D30" Foreground="White" BorderThickness="0" Height="320">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Padding="10" BorderBrush="#3A3A3A" BorderThickness="0,0,0,1">
                            <StackPanel>
                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" Foreground="White"/>
                                <TextBlock Text="{Binding Category}" Foreground="#AAA" FontSize="12"/>
                                <TextBlock Text="{Binding StartTime, StringFormat=yyyy-MM-dd HH:mm}" Foreground="#AAA" FontSize="12"/>
                                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                    <Button Content="Create Again" Command="{Binding DataContext.DuplicateEventCommand, RelativeSource={RelativeSource AncestorType=ListBox}}" CommandParameter="{Binding}" Height="26" FontSize="11" Style="{StaticResource MaterialDesignFlatButton}"/>
                                    <Button Content="Delete" Command="{Binding DataContext.DeleteEventCommand, RelativeSource={RelativeSource AncestorType=ListBox}}" CommandParameter="{Binding}" Height="26" FontSize="11" Foreground="#F44336" Style="{StaticResource MaterialDesignFlatButton}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <TextBlock Text="Templates" FontSize="16" FontWeight="SemiBold" Foreground="White" Margin="0,12,0,8"/>
            <ListBox ItemsSource="{Binding Templates}" SelectedItem="{Binding SelectedTemplate}" Background="#2D2D30" Foreground="White" BorderThickness="0" Height="200">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Padding="10" BorderBrush="#3A3A3A" BorderThickness="0,0,0,1">
                            <StackPanel>
                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" Foreground="White"/>
                                <TextBlock Text="{Binding Category}" Foreground="#AAA" FontSize="12"/>
                                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                    <Button Content="Create" Command="{Binding DataContext.CreateFromTemplateCommand, RelativeSource={RelativeSource AncestorType=ListBox}}" CommandParameter="{Binding}" Height="26" FontSize="11" Style="{StaticResource MaterialDesignFlatButton}"/>
                                    <Button Content="Delete" Command="{Binding DataContext.DeleteTemplateCommand, RelativeSource={RelativeSource AncestorType=ListBox}}" CommandParameter="{Binding}" Height="26" FontSize="11" Foreground="#F44336" Style="{StaticResource MaterialDesignFlatButton}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </StackPanel>
    </Grid>
</UserControl>
