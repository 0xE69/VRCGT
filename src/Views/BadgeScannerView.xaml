<UserControl x:Class="VRCGroupTools.Views.BadgeScannerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="ðŸ” 18+ Badge Scanner" FontSize="28" FontWeight="Bold" Foreground="White"/>
            <TextBlock Text="Scan group members to identify age-verified users" Foreground="#888" FontSize="14" Margin="0,5,0,0"/>
        </StackPanel>
        
        <!-- Controls -->
        <Border Grid.Row="1" Background="#2D2D30" CornerRadius="8" Padding="20" Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBox Text="{Binding GroupId, UpdateSourceTrigger=PropertyChanged}"
                             Width="350"
                             materialDesign:HintAssist.Hint="Group ID or VRChat Group URL"
                             Foreground="White"
                             CaretBrush="White"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             IsEnabled="{Binding IsScanning, Converter={StaticResource InverseBooleanConverter}}"/>
                </StackPanel>
                
                <Button Grid.Column="1" 
                        Content="Start Scan"
                        Command="{Binding StartScanCommand}"
                        Width="120"
                        Height="40"
                        Margin="15,0,0,0"
                        FontWeight="Bold"
                        Style="{StaticResource MaterialDesignRaisedDarkButton}"
                        Background="#7C4DFF"
                        Visibility="{Binding IsScanning, Converter={StaticResource InverseBoolToVisConverter}}"/>
                
                <Button Grid.Column="1" 
                        Content="Stop"
                        Command="{Binding StopScanCommand}"
                        Width="120"
                        Height="40"
                        Margin="15,0,0,0"
                        FontWeight="Bold"
                        Style="{StaticResource MaterialDesignRaisedDarkButton}"
                        Background="#F44336"
                        Visibility="{Binding IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                
                <Button Grid.Column="2" 
                        Content="ðŸ“ Export CSV"
                        Command="{Binding ExportToCSVCommand}"
                        Width="120"
                        Height="40"
                        Margin="10,0,0,0"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        IsEnabled="{Binding IsScanning, Converter={StaticResource InverseBooleanConverter}}"/>
            </Grid>
        </Border>
        
        <!-- Progress & Stats -->
        <Border Grid.Row="2" Background="#2D2D30" CornerRadius="8" Padding="20" Margin="0,0,0,15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                        <TextBlock Text="{Binding TotalMembers}" FontSize="32" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center"/>
                        <TextBlock Text="Total Members" Foreground="#888" HorizontalAlignment="Center"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                        <TextBlock Text="{Binding ScannedMembers}" FontSize="32" FontWeight="Bold" Foreground="#2196F3" HorizontalAlignment="Center"/>
                        <TextBlock Text="Scanned" Foreground="#888" HorizontalAlignment="Center"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                        <TextBlock Text="{Binding VerifiedCount}" FontSize="32" FontWeight="Bold" Foreground="#4CAF50" HorizontalAlignment="Center"/>
                        <TextBlock Text="Verified (18+)" Foreground="#888" HorizontalAlignment="Center"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                        <TextBlock Text="{Binding UnverifiedCount}" FontSize="32" FontWeight="Bold" Foreground="#F44336" HorizontalAlignment="Center"/>
                        <TextBlock Text="Not Verified" Foreground="#888" HorizontalAlignment="Center"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                        <TextBlock Text="{Binding KickedCount}" FontSize="32" FontWeight="Bold" Foreground="#FF9800" HorizontalAlignment="Center"/>
                        <TextBlock Text="Kicked" Foreground="#888" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
                
                <ProgressBar Grid.Row="1" 
                             Value="{Binding ProgressPercent}" 
                             Maximum="100"
                             Height="8"
                             Margin="0,20,0,10"
                             Style="{StaticResource MaterialDesignLinearProgressBar}"/>
                
                <TextBlock Grid.Row="2" 
                           Text="{Binding StatusMessage}" 
                           Foreground="#AAA" 
                           HorizontalAlignment="Center"/>
            </Grid>
        </Border>
        
        <!-- Results Table -->
        <Border Grid.Row="3" Background="#2D2D30" CornerRadius="8" Padding="15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Filter and Actions -->
                <Grid Grid.Row="0" Margin="0,0,0,10">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                        <TextBlock Text="Filter:" Foreground="#888" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <RadioButton Content="All" 
                                     IsChecked="{Binding FilterMode, Converter={StaticResource StringMatchConverter}, ConverterParameter=All}"
                                     GroupName="Filter"
                                     Style="{StaticResource MaterialDesignTabRadioButton}"
                                     Margin="0,0,5,0"/>
                        <RadioButton Content="Verified" 
                                     IsChecked="{Binding FilterMode, Converter={StaticResource StringMatchConverter}, ConverterParameter=Verified}"
                                     GroupName="Filter"
                                     Style="{StaticResource MaterialDesignTabRadioButton}"
                                     Foreground="#4CAF50"
                                     Margin="0,0,5,0"/>
                        <RadioButton Content="Not Verified" 
                                     IsChecked="{Binding FilterMode, Converter={StaticResource StringMatchConverter}, ConverterParameter=Unverified}"
                                     GroupName="Filter"
                                     Style="{StaticResource MaterialDesignTabRadioButton}"
                                     Foreground="#F44336"
                                     Margin="0,0,5,0"/>
                        <RadioButton Content="Unknown" 
                                     IsChecked="{Binding FilterMode, Converter={StaticResource StringMatchConverter}, ConverterParameter=Unknown}"
                                     GroupName="Filter"
                                     Style="{StaticResource MaterialDesignTabRadioButton}"
                                     Foreground="#9E9E9E"/>
                    </StackPanel>
                </Grid>
                
                <!-- Kick Action Buttons -->
                <WrapPanel Grid.Row="1" HorizontalAlignment="Left" Margin="0,0,0,10">
                    <Button Content="ðŸ“‹ Copy Unverified"
                            Command="{Binding CopyUnverifiedToClipboardCommand}"
                            Width="170"
                            Height="36"
                            Margin="0,0,8,0"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Foreground="#9C27B0"
                            FontSize="13"
                            Padding="8,4"
                            ToolTip="Copy all unverified members to clipboard"/>
                    <Button Content="ðŸ“‹ Copy Filtered"
                            Command="{Binding CopyFilteredToClipboardCommand}"
                            Width="150"
                            Height="36"
                            Margin="0,0,8,0"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Foreground="#9C27B0"
                            FontSize="13"
                            Padding="8,4"
                            ToolTip="Copy currently filtered results to clipboard"/>
                    <Button Content="âœ”ï¸ Select All Unverified"
                            Command="{Binding SelectAllUnverifiedCommand}"
                            Width="190"
                            Height="36"
                            Margin="0,0,8,0"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Foreground="#2196F3"
                            FontSize="13"
                            Padding="8,4"
                            IsEnabled="{Binding IsKicking, Converter={StaticResource InverseBooleanConverter}}"/>
                    <Button Content="âŒ Unselect All"
                            Command="{Binding UnselectAllCommand}"
                            Width="135"
                            Height="36"
                            Margin="0,0,8,0"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Foreground="#888"
                            FontSize="13"
                            Padding="8,4"
                            IsEnabled="{Binding IsKicking, Converter={StaticResource InverseBooleanConverter}}"/>
                    <Button Content="ðŸ‘¢ Kick Selected"
                            Command="{Binding KickSelectedCommand}"
                            Width="145"
                            Height="36"
                            Margin="0,0,8,0"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="#FF9800"
                            FontSize="13"
                            Padding="8,4"
                            IsEnabled="{Binding IsKicking, Converter={StaticResource InverseBooleanConverter}}"/>
                    <Button Content="ðŸ‘¢ Kick All Unverified"
                            Command="{Binding KickAllUnverifiedCommand}"
                            Width="185"
                            Height="36"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="#F44336"
                            FontSize="13"
                            Padding="8,4"
                            IsEnabled="{Binding IsKicking, Converter={StaticResource InverseBooleanConverter}}"/>
                </WrapPanel>
                
                <!-- Data Grid -->
                <DataGrid Grid.Row="2"
                          ItemsSource="{Binding FilteredResults}"
                          AutoGenerateColumns="False"
                          Background="Transparent"
                          BorderThickness="0"
                          RowBackground="#2D2D30"
                          AlternatingRowBackground="#333333"
                          GridLinesVisibility="None"
                          HeadersVisibility="Column"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          SelectionMode="Single"
                          Style="{StaticResource MaterialDesignDataGrid}">
                    <DataGrid.Columns>
                        <DataGridCheckBoxColumn Header="Select" Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" Width="60"/>
                        <DataGridTextColumn Header="Display Name" Binding="{Binding DisplayName}" Width="*"/>
                        <DataGridTextColumn Header="User ID" Binding="{Binding UserId}" Width="280"/>
                        <DataGridTemplateColumn Header="Status" Width="150">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding VerificationStatus}" 
                                               Foreground="{Binding StatusColor}"
                                               FontWeight="SemiBold"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>
        
        <!-- Footer -->
        <TextBlock Grid.Row="4" 
                   Text="{Binding FilteredResults.Count, StringFormat='Showing {0} results'}" 
                   Foreground="#666" 
                   Margin="0,10,0,0"/>
    </Grid>
</UserControl>
